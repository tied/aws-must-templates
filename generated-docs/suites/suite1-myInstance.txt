
AwsCommandLineInterfaceInstalled
  Command "type aws"
    exit_status
      should eq 0

CloudFormationHelperScriptsInstalled
  Command "type cfn-init"
    exit_status
      should eq 0
  Command "type cfn-signal"
    exit_status
      should eq 0
  Command "type cfn-get-metadata"
    exit_status
      should eq 0
  Command "type cfn-hup"
    exit_status
      should eq 0

Ec2PublicIp
  instance 'myInstance'
    Public IP
      ec2: instanceName=myInstance
        public_ip_address
          should not eql nil

Ec2StatusNormal
  instanceName 'myInstance'
    ec2: instanceName=myInstance
      system_status_not_impaired?
        should eq true
    ec2: instanceName=myInstance
      instance_state_running?
        should eq true

S3ReadAccessAllowed
  Test parameter definition
    Test parameter 'Bucket' for role 'S3ReadAccessAllowed'
      definition_in_test_suite
        should not eq nil
  Test parameter values
    Test parameter 'Bucket' for role 'S3ReadAccessAllowed'
      value
        should not eq nil
  Operating system context
    Aws Commad Line Interface (CLI) is installed
      Command "type aws"
        exit_status
          should eq 0
  When read access to a S3 bucket granted
    Can list S3 buckets
      Command "aws s3 ls"
        exit_status
          should eq 0
    Can list S3 bucket keys
      Command "aws s3 ls s3://suite1-mybucket-797jcqsn0q0 || aws s3 ls s3://suite1-mybucket-797jcqsn0q0 --region $(aws s3api get-bucket-location --bucket suite1-mybucket-797jcqsn0q0 --output text)"
        exit_status
          should eq 0
    When an Object exists in S3 bucket
      Can read the Object from a S3 bucket
        Command "aws s3 cp s3://suite1-mybucket-797jcqsn0q0/ttest.tmp /tmp/ttest.tmp || aws s3 cp s3://suite1-mybucket-797jcqsn0q0/ttest.tmp /tmp/ttest.tmp --region $(aws s3api get-bucket-location --bucket suite1-mybucket-797jcqsn0q0 --output text)"
          exit_status
            should eq 0
      Cannot modify (= delete) the  Object in bucket
        Command "aws s3 rm s3://suite1-mybucket-797jcqsn0q0/ttest.tmp --region $(aws s3api get-bucket-location --bucket suite1-mybucket-797jcqsn0q0 --output text)"
          exit_status
            should not eql 0
    Cannot write to bucket
      Create an Object in bucket should fail
        Command "aws s3 cp /etc/hosts  s3://suite1-mybucket-797jcqsn0q0/ttest.tmp --region $(aws s3api get-bucket-location --bucket suite1-mybucket-797jcqsn0q0 --output text)"
          exit_status
            should not eql 0
  When bucket does not exists
    Cannot list S3 bucket keys
      Command "aws s3 ls s3://DASKLjwKLJ4534Buckert --region $(aws s3api get-bucket-location --bucket  --output text)"
        exit_status
          should not eq 0

ValidOSVersion
  Operating system codename 'trusty'
    Command "lsb_release --c -s"
      stdout
        should match /trusty/

Finished in 27.57 seconds (files took 1.21 seconds to load)
18 examples, 0 failures

